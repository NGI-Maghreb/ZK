/*
 * Jsgauge 0.4.3
 * http://code.google.com/p/jsgauge/
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/mit-license.php
 */
function Gauge(b,i){var f=this;this.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;this.cancelRequestAnimFrame=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame;this.animationToken=null;this.canvas=b;function h(j){f.settings={value:j.value||0,valueFormat:j.valueFormat||null,pointerValue:j.value||0,label:j.label||"",unitsLabel:j.unitsLabel||"",min:j.min||0,max:j.max||100,majorTicks:j.majorTicks||5,minorTicks:j.minorTicks||2,bands:[].concat(j.bands||[]),greenFrom:[].concat(j.greenFrom||0),greenTo:[].concat(j.greenTo||0),yellowFrom:[].concat(j.yellowFrom||0),yellowTo:[].concat(j.yellowTo||0),redFrom:[].concat(j.redFrom||0),redTo:[].concat(j.redTo||0)};f.colors={text:j.colorOfText||"rgb(0, 0, 0)",warningText:j.colorOfWarningText||"rgb(255, 0, 0)",fill:j.colorOfFill||["#111","#ccc","#ddd","#eee"],pointerFill:j.colorOfPointerFill||"rgba(255, 100, 0, 0.7)",pointerStroke:j.colorOfPointerStroke||"rgba(255, 100, 100, 0.9)",centerCircleFill:j.colorOfCenterCircleFill||"rgba(0, 100, 255, 1)",centerCircleStroke:j.colorOfCenterCircleStroke||"rgba(0, 0, 255, 1)",redBand:j.colorOfRedBand||j.redColor||"rgba(255, 0, 0, 0.2)",yelBand:j.colorOfYellowBand||j.yellowColor||"rgba(255, 215, 0, 0.2)",grnBand:j.colorOfGreenBand||j.greenColor||"rgba(0, 255, 0, 0.2)"};for(var k=f.settings.redFrom.length;k--;){f.settings.bands.push({color:f.colors.redBand,from:f.settings.redFrom[k],to:f.settings.redTo[k]})}for(k=f.settings.yellowFrom.length;k--;){f.settings.bands.push({color:f.colors.yelBand,from:f.settings.yellowFrom[k],to:f.settings.yellowTo[k]})}for(k=f.settings.greenFrom.length;k--;){f.settings.bands.push({color:f.colors.grnBand,from:f.settings.greenFrom[k],to:f.settings.greenTo[k]})}f.relSettings=d(f.settings)}function d(l){var j,k=l.max-l.min,o=k/100,n;if(l.pointerValue>l.max){l.pointerValue=l.max}else{if(l.pointerValue<l.min){l.pointerValue=l.min}}n={min:0,max:100,value:(l.value-l.min)/o,pointerValue:(l.pointerValue-l.min)/o,label:l.label||"",greenFrom:[],greenTo:[],yellowFrom:[],yellowTo:[],redFrom:[],redTo:[],bands:[],majorTicks:Math.max(2,l.majorTicks),minorTicks:Math.max(0,l.minorTicks),decimals:Math.max(0,3-(l.max-l.min).toFixed(0).length)};for(j=l.bands.length;j--;){var m=l.bands[j];n.bands[j]={color:m.color,from:(m.from-l.min)/o,to:(m.to-l.min)/o}}return n}function e(l,j){var k;if(typeof f.settings.valueFormat=="function"){return f.settings.valueFormat(l,j)}k=l.toFixed(j);while((j>0)&&k.match(/^(-)?\d+\.(\d+)?0$/)){j-=1;k=l.toFixed(j)}return k}function a(j,k){j.font=k;j.mozTextStyle=k}function c(j,k){if(j.measureText){return j.measureText(k).width}else{if(j.mozMeasureText){return j.mozMeasureText(k)}}throw"measureText() not supported!"}function g(l,n,k,j){var m;if(l.fillText){return l.fillText(n,k,j)}else{if(l.mozDrawText){l.save();l.translate(k,j);m=l.mozDrawText(n);l.restore();return m}}throw"fillText() not supported!"}this.setOptions=h;this.setOptions(i||{});this.drawBackground=function(){var l=f.colors.fill,j=[this.radius,this.radius-1,this.radius*0.98,this.radius*0.95],k;this.c2d.rotate(this.startDeg);for(k=0;k<l.length;k++){this.c2d.fillStyle=l[k];this.c2d.beginPath();this.c2d.arc(0,0,j[k],0,this.spanDeg,false);this.c2d.fill()}};this.drawRange=function(m,l,k){if(l>m){var j=this.spanDeg*(l-m)/100;this.c2d.rotate(this.startDeg);this.c2d.fillStyle=k;this.c2d.rotate(this.spanDeg*m/100);this.c2d.beginPath();this.c2d.moveTo(this.innerRadius,0);this.c2d.lineTo(this.outerRadius,0);this.c2d.arc(0,0,this.outerRadius,0,j,false);this.c2d.rotate(j);this.c2d.lineTo(this.innerRadius,0);this.c2d.arc(0,0,this.innerRadius,0,-j,true);this.c2d.fill()}};this.drawTicks=function(p,l){var o,n,k;this.c2d.rotate(this.startDeg);this.c2d.lineWidth=this.radius*0.025;o=this.spanDeg/(p-1);for(n=0;n<p;n++){this.c2d.beginPath();this.c2d.moveTo(this.innerRadius,0);this.c2d.lineTo(this.outerRadius,0);this.c2d.stroke();if(n+1<p){this.c2d.save();this.c2d.lineWidth=this.radius*0.01;var m=o/(l+1);for(k=0;k<l;k++){this.c2d.rotate(m);this.c2d.beginPath();this.c2d.moveTo(this.innerRadius+(this.outerRadius-this.innerRadius)/3,0);this.c2d.lineTo(this.outerRadius,0);this.c2d.stroke()}this.c2d.restore()}this.c2d.rotate(o)}};this.drawPointer=function(j){function k(l){l.c2d.beginPath();l.c2d.moveTo(-l.radius*0.2,0);l.c2d.lineTo(0,l.radius*0.05);l.c2d.lineTo(l.radius*0.8,0);l.c2d.lineTo(0,-l.radius*0.05);l.c2d.lineTo(-l.radius*0.2,0)}this.c2d.rotate(this.startDeg);this.c2d.rotate(this.spanDeg*j/100);this.c2d.lineWidth=this.radius*0.015;this.c2d.fillStyle=f.colors.pointerFill;k(this);this.c2d.fill();this.c2d.strokeStyle=f.colors.pointerStroke;k(this);this.c2d.stroke();this.c2d.fillStyle=f.colors.centerCircleFill;this.c2d.beginPath();this.c2d.arc(0,0,this.radius*0.1,0,Math.PI*2,true);this.c2d.fill();this.c2d.strokeStyle=f.colors.centerCircleStroke;this.c2d.beginPath();this.c2d.arc(0,0,this.radius*0.1,0,Math.PI*2,true);this.c2d.stroke()};this.drawCaption=function(k){if(k){var n=this.radius/5;a(this.c2d,n.toFixed(0)+"px sans-serif");var m=c(this.c2d,k);this.c2d.fillStyle=f.colors.text;var l=-m/2;var j=-this.radius*0.4+n/2;g(this.c2d,k,l,j)}};this.drawValues=function(m,j,q,k){var o,p,n,l;l=e(q,k)+f.settings.unitsLabel;p=this.radius/5;a(this.c2d,p.toFixed(0)+"px sans-serif");n=c(this.c2d,l);if(q<m||q>j){this.c2d.fillStyle=f.colors.warningText}else{this.c2d.fillStyle=f.colors.text}g(this.c2d,l,-n/2,this.radius*0.72);this.save();o=Math.PI*14.5/8;this.c2d.translate(this.radius*0.65*Math.sin(o),this.radius*0.65*Math.cos(o));p=this.radius/8;a(this.c2d,p.toFixed(0)+"px sans-serif");this.c2d.fillStyle=f.colors.text;g(this.c2d,e(m,k),0,0);this.restore();this.save();o=Math.PI*17.5/8;this.c2d.translate(this.radius*0.65*Math.sin(o),this.radius*0.65*Math.cos(o));p=this.radius/8;a(this.c2d,p.toFixed(0)+"px sans-serif");n=c(this.c2d,e(j,k));this.c2d.fillStyle=f.colors.text;g(this.c2d,e(j,k),-n,0);this.restore()};this.draw();return this}Gauge.prototype.setValue=function(e){var d=this,c=(e>d.settings.max)?d.settings.max:(e<d.settings.min)?d.settings.min:e,a=Math.abs(d.settings.pointerValue-c)/20;if(d.cancelRequestAnimFrame){d.cancelRequestAnimFrame(d.animationToken)}else{clearTimeout(d.animationToken)}function b(){var f;if(d.settings.pointerValue<c){d.settings.pointerValue+=a;if(d.settings.pointerValue+a>=c){d.settings.pointerValue=c}}else{d.settings.pointerValue-=a;if(d.settings.pointerValue-a<=c){d.settings.pointerValue=c}}f=d.settings.max-d.settings.min;d.relSettings.pointerValue=(d.settings.pointerValue-d.settings.min)/(f/100);d.draw();if(d.settings.pointerValue!=c){if(typeof d.requestAnimFrame!="undefined"){d.animationToken=d.requestAnimFrame.call(window,b)}else{d.animationToken=setTimeout(b,50)}}}if(!isNaN(e)&&this.settings.value!==e){this.settings.value=e;b()}};Gauge.prototype.draw=function(){var c,b,f;if(!this.canvas.getContext){return}var d={c2d:this.canvas.getContext("2d"),startDeg:Math.PI*5.5/8,spanDeg:Math.PI*13/8,save:function(){this.c2d.save()},restore:function(){this.c2d.restore()},call:function(h){var g=Array.prototype.slice.call(arguments);this.save();this.translateCenter();h.apply(this,g.slice(1));this.restore()},clear:function(){this.c2d.clearRect(0,0,this.width,this.height)},translateCenter:function(){this.c2d.translate(this.centerX,this.centerY)}};d.width=d.c2d.canvas.width;d.height=d.c2d.canvas.height;d.radius=Math.min(d.width/2-4,d.height/2-4);d.innerRadius=d.radius*0.7;d.outerRadius=d.radius*0.9;d.centerX=d.radius+4;d.centerY=d.radius+4+(d.radius-d.radius*Math.sin(d.startDeg))/2;d.clear();d.call(this.drawBackground);for(var a=this.relSettings.bands.length;a--;){var e=this.relSettings.bands[a];d.call(this.drawRange,e.from,e.to,e.color)}d.call(this.drawTicks,this.relSettings.majorTicks,this.relSettings.minorTicks);d.call(this.drawPointer,this.relSettings.pointerValue);d.call(this.drawCaption,this.relSettings.label);d.call(this.drawValues,this.settings.min,this.settings.max,this.settings.value,this.relSettings.decimals)};